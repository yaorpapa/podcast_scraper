name: Daily Web Crawler

on:
  schedule:
    - cron: '0 0 * * *'

jobs:
  run-crawler:
    runs-on: windows-latest
    env:
      PYTHONIOENCODING: utf-8  # 強制 Python 使用 UTF-8 編碼
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Setup msedgedriver
        run: |
          Invoke-WebRequest -Uri "https://msedgedriver.azureedge.net/114.0.1823.43/edgedriver_win64.zip" -OutFile "edgedriver_win64.zip"
          Expand-Archive -Path "edgedriver_win64.zip" -DestinationPath "."
          if (!(Test-Path "./msedgedriver.exe")) {
            Write-Error "msedgedriver.exe 未找到，請檢查下載連結及版本號！"
          }

      - name: Run Crawler
        run: python podcast_scraper.py
